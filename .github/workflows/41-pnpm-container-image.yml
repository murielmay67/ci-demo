on:
  push:
    branches: ["main"]
  pull_request:
defaults:
  run:
    shell: bash
jobs:
  pnpm-image:
    runs-on: ubuntu-latest
    container:
      # image: yanhao98/pnpm:8-node16
      image: yanhao98/pnpm:8-node${{ matrix.node-version }}
    strategy:
      matrix:
        node-version:
          - 18
          - 20
    steps:
      - uses: actions/checkout@v4

      - name: pnpm version
        run: pnpm -v

      - name: Install Dependencies
        run: |
          time pnpm install -r --frozen-lockfile --store-dir "$RUNNER_TOOL_CACHE/pnpm-store"

      - name: Build vite-react-ts
        run: time pnpm run build
        working-directory: vite-react-ts
      
      - name: Build vite-vue-ts
        run: time pnpm run build
        working-directory: vite-vue-ts

      - name: TestHash
        shell: bash
        run: |
          echo "START"
          # https://github.com/nektos/act/issues/1012
          echo "-${{ hashFiles('vite-vue-ts/pnpm-lock.yaml') }}"
          echo "-${{ hashFiles('vite-react-ts/pnpm-lock.yaml') }}"
          echo "-${{ hashFiles('vite-vue-ts/pnpm-lock.yaml', 'vite-react-ts/pnpm-lock.yaml') }}"
          echo "-${{ hashFiles('vite-react-ts/pnpm-lock.yaml', 'vite-vue-ts/pnpm-lock.yaml') }}"
          echo "-${{ hashFiles('**/pnpm-lock.yaml') }}"
          echo "END"
